<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的 - 金融借贷平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 欢迎头部 -->
    <div class="welcome-header">
        <div class="welcome-text">我的</div>
        <div class="welcome-subtext">个人账户管理中心</div>
        <div id="currentTime" style="font-size: 14px; margin-top: 10px;"></div>
    </div>

    <!-- 用户信息区域 -->
    <div class="user-info">
        <div class="user-avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="user-info-text">138****8888</div>
        <button class="btn btn-outline" id="realnameBtn" style="margin-top: 10px;">去实名认证</button>
    </div>

    <!-- 额度信息卡片 -->
    <div class="credit-limit-card">
        <div class="limit-label">您的最高可贷额度</div>
        <div class="limit-amount">200,000<span style="font-size: 18px; margin-left: 5px;">元</span></div>
        <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">已获得审批，随时可借</div>
    </div>

    <!-- 账户余额和提现按钮 -->
    <div style="max-width: 90%; margin: 20px auto; padding: 15px; background: white; border-radius: 15px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-size: 14px; color: #666; margin-bottom: 5px;">账户余额</div>
                <div style="font-size: 24px; font-weight: bold; color: #333;">2,000.00<span style="font-size: 14px; margin-left: 5px;">元</span></div>
            </div>
            <button id="withdrawButton" style="padding: 10px 20px; background: linear-gradient(135deg, #0f4c81, #1a3a5f); color: white; border: none; border-radius: 20px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;">
                提现
            </button>
        </div>
    </div>

    <!-- 常用功能网格 -->
    <div class="common-functions">
        <h3>常用功能</h3>
        <div class="function-grid">
            <div class="function-item">
                <div class="function-icon" style="background: #0f4c81;"><i class="fas fa-file-invoice-dollar"></i></div>
                <div class="function-name">我的账单</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #1a3a5f;"><i class="fas fa-exchange-alt"></i></div>
                <div class="function-name">交易记录</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #2c5ba5;"><i class="fas fa-id-card"></i></div>
                <div class="function-name">实名认证</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #3a6bb1;"><i class="fas fa-credit-card"></i></div>
                <div class="function-name">银行卡</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #4a7bc7;"><i class="fas fa-question-circle"></i></div>
                <div class="function-name">帮助中心</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #5a8bd3;"><i class="fas fa-headset"></i></div>
                <div class="function-name">在线客服</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #6a9be9;"><i class="fas fa-cog"></i></div>
                <div class="function-name">设置</div>
            </div>
            <div class="function-item">
                <div class="function-icon" style="background: #7aaaf5;"><i class="fas fa-sign-out-alt"></i></div>
                <div class="function-name">退出登录</div>
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <div class="nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>首页</span>
        </a>
        <a href="loan.html" class="nav-item">
            <i class="fas fa-money-bill-wave"></i>
            <span>贷款</span>
        </a>
        <a href="message.html" class="nav-item">
            <i class="fas fa-bell"></i>
            <span>消息</span>
        </a>
        <a href="mine.html" class="nav-item active">
            <i class="fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>

    <script>
        // 时间自动更新
        function updateTime() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            hours = hours < 10 ? '0' + hours : hours;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            const timeString = hours + ':' + minutes;
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // 根据登录状态更新用户数据
        function updateUserDataBasedOnLogin() {
            // 从localStorage获取登录状态和用户信息
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const loginMethod = localStorage.getItem('loginMethod');
            let userInfo;
            
            try {
                // 尝试获取email登录的用户信息
                userInfo = JSON.parse(localStorage.getItem('userInfo'));
            } catch (e) {
                userInfo = null;
            }
            
            // 如果是邮箱登录方式
            if (isLoggedIn && loginMethod === 'email' && userInfo && userInfo.email) {
                const userInfoElement = document.querySelector('.user-info-text');
                const email = userInfo.email;
                
                // 对邮箱进行脱敏处理，只显示前3位和域名
                if (email.includes('@')) {
                    const [username, domain] = email.split('@');
                    const maskedUsername = username.substring(0, 3) + '****';
                    const maskedEmail = maskedUsername + '@' + domain;
                    userInfoElement.textContent = maskedEmail;
                } else {
                    userInfoElement.textContent = email; // 如果格式不正确，显示原始邮箱
                }
                return;
            }
            
            // 尝试从authData中获取用户信息（账号密码登录方式）
            try {
                const authData = JSON.parse(localStorage.getItem('authData'));
                if (authData && authData.accessToken) {
                    // 这里需要根据实际情况解析token获取用户信息
                    // 简化处理：显示一个默认的账号格式
                    const userInfoElement = document.querySelector('.user-info-text');
                    
                    // 为了示例，我们仍然使用phone格式，但实际应该从token中解析
                    userInfoElement.textContent = '138****8888';
                }
            } catch (e) {
                console.error('解析authData失败:', e);
            }
        }
        
        // 模拟获取并显示用户邮箱（演示用）
        function simulateUserLogin() {
            // 仅用于演示：如果没有登录状态，模拟一个已登录的邮箱用户
            if (!localStorage.getItem('userLoggedIn')) {
                // 演示用：设置一个模拟的登录状态和邮箱
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('loginMethod', 'email');
                localStorage.setItem('userInfo', JSON.stringify({email: 'demo@example.com'}));
                console.log('已模拟邮箱用户登录状态');
            }
        }
        
        // 初始化时间并设置定时器
        updateTime();
        setInterval(updateTime, 60000);
        
        // 模拟用户登录状态（仅用于演示）
        simulateUserLogin();
        
        // 更新用户数据
        updateUserDataBasedOnLogin();

        // 根据人脸识别状态控制"去实名认证"按钮显示
        (function() {
            const realnameBtn = document.getElementById('realnameBtn');
            if (realnameBtn) {
                const isFaceRecDone = localStorage.getItem('is_face_rec') === 'true';
                realnameBtn.style.display = isFaceRecDone ? 'none' : '';
            }
        })();

        // 实名认证按钮点击事件
        document.getElementById('realnameBtn').addEventListener('click', function() {
            window.location.href = '实名认证.html';
        });
        
        // 提现按钮点击事件
        document.getElementById('withdrawButton').addEventListener('click', function() {
            window.location.href = 'withdraw.html';
        });
        
        // 为功能项添加点击事件
        document.querySelectorAll('.function-item').forEach(item => {
            item.addEventListener('click', function() {
                const functionName = this.querySelector('.function-name').textContent;
                if (functionName === '我的账单') {
                    window.location.href = './order_repay/bill_list.html';
                } else if (functionName === '交易记录') {
                    window.location.href = 'transaction_history.html';
                } else if (functionName === '实名认证') {
                    window.location.href = '实名认证.html';
                } else if (functionName === '银行卡') {
                    window.location.href = 'bank_cards.html';
                } else if (functionName === '帮助中心') {
                    window.location.href = 'help_center.html';
                } else if (functionName === '在线客服') {
                    window.location.href = 'online_service.html';
                } else if (functionName === '设置') {
                    window.location.href = 'settings.html';
                } else if (functionName === '退出登录') {
                    // 模拟退出登录
                    if (confirm('确定要退出登录吗？')) {
                        // 清除登录状态
                        localStorage.removeItem('userLoggedIn');
                        localStorage.removeItem('loginMethod');
                        localStorage.removeItem('userInfo');
                        localStorage.removeItem('authData');
                        
                        alert('已退出登录');
                        // 跳转到登录页面
                        window.location.href = 'username_pwd.html';
                    }
                }
            });
        });
        
        // 为导航项添加点击事件
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                // 移除所有活跃状态
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                // 添加当前活跃状态
                this.classList.add('active');
                // 导航到相应页面（通过href属性已经实现）
            });
        });
    </script>
</body>
</html>