<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人脸识别 - 极速贷款</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0 20px;
            padding-bottom: 80px;
            background: #f5f5f5;
        }

        .welcome-header {
            padding: 20px 0;
            text-align: center;
        }

        .welcome-text {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .face-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .tip {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* 摄像头区域 */
        .camera-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 75%; /* 4:3 比例 */
            margin: 20px 0;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }

        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .face-guide {
            width: 70%;
            height: 70%;
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 8px;
        }

        /* 拍照按钮 */
        .capture-btn {
            display: block;
            width: 60px;
            height: 60px;
            margin: 0 auto;
            background: #fff;
            border: 4px solid #4CAF50;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
        }

        .capture-btn:active {
            transform: scale(0.95);
        }

        .capture-btn::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: #4CAF50;
            border-radius: 50%;
        }

        /* 拍照结果 */
        .result-container {
            display: none;
            margin: 20px 0;
            text-align: center;
        }

        #canvas {
            max-width: 100%;
            border-radius: 8px;
        }

        /* 按钮 */
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            font-size: 16px;
            font-weight: bold;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* 状态提示 */
        .status-tip {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }

        .status-tip.success {
            color: #4CAF50;
        }

        .status-tip.error {
            color: #f44336;
        }

        /* 底部导航栏 */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background: white;
            border-top: 1px solid #ddd;
            padding: 10px 0;
        }

        .nav-item {
            text-align: center;
            color: #666;
            text-decoration: none;
        }

        .nav-item i {
            display: block;
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-item span {
            font-size: 12px;
        }

        .nav-item.active {
            color: #4CAF50;
        }
    </style>
</head>
<body>
<div class="welcome-header">
    <div class="welcome-text">人脸识别验证</div>
</div>

<div class="face-card">
    <div class="tip">
        请确保光线充足，正对摄像头，保持面部在框内
    </div>

    <!-- 摄像头区域 -->
    <div class="camera-container">
        <video id="video" autoplay playsinline></video>
        <div class="camera-overlay">
            <div class="face-guide"></div>
        </div>
    </div>

    <!-- 拍照按钮 -->
    <button class="capture-btn" id="capture-btn"></button>

    <!-- 拍照结果 -->
    <div class="result-container" id="result-container">
        <canvas id="canvas"></canvas>
        <div class="status-tip" id="status-tip">
            <i class="fas fa-spinner fa-spin"></i> 正在识别中...
        </div>
        <button class="btn" id="retry-btn">重新拍摄</button>
        <button class="btn" id="submit-btn" disabled>确认提交</button>
    </div>

    <!-- 隐私提示 -->
    <div class="privacy-tip">
        <i class="fas fa-shield-alt" style="margin-right: 5px;"></i>
        信息不留存，仅用于身份验证，严格保密
    </div>
</div>

<!-- 底部导航栏 -->
<div class="nav">
    <a href="index.html" class="nav-item">
        <i class="fas fa-home"></i>
        <span>首页</span>
    </a>
    <a href="loan.html" class="nav-item">
        <i class="fas fa-money-bill-wave"></i>
        <span>借贷</span>
    </a>
    <a href="message.html" class="nav-item">
        <i class="fas fa-comment-dots"></i>
        <span>消息</span>
    </a>
    <a href="mine.html" class="nav-item">
        <i class="fas fa-user"></i>
        <span>我的</span>
    </a>
</div>

<script>
    // DOM元素
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const captureBtn = document.getElementById('capture-btn');
    const retryBtn = document.getElementById('retry-btn');
    const submitBtn = document.getElementById('submit-btn');
    const resultContainer = document.getElementById('result-container');
    const statusTip = document.getElementById('status-tip');

    // 拍照状态
    let isCaptured = false;
    let photoData = null;

    // 初始化摄像头
    async function initCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: 'user', // 前置摄像头
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                },
                audio: false
            });
            video.srcObject = stream;
        } catch (err) {
            console.error('摄像头访问失败:', err);
            statusTip.innerHTML = `<i class="fas fa-exclamation-circle"></i> 摄像头访问失败: ${err.message}`;
            statusTip.className = 'status-tip error';
            captureBtn.disabled = true;
        }
    }

    // 拍照功能
    function capturePhoto() {
        if (isCaptured) return;

        // 设置canvas尺寸与视频相同
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // 绘制当前视频帧到canvas
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // 显示结果区域
        resultContainer.style.display = 'block';
        isCaptured = true;

        // 停止视频流
        video.srcObject.getTracks().forEach(track => track.stop());

        // 提取照片数据 (Base64格式)
        photoData = canvas.toDataURL('image/jpeg', 0.8);

        // 开始人脸识别 (模拟)
        simulateFaceRecognition();
    }

    // 模拟人脸识别过程
    function simulateFaceRecognition() {
        // 这里替换为实际的人脸识别API调用
        // 示例:
        // realFaceRecognition(photoData)
        //   .then(result => { ... })
        //   .catch(error => { ... });

        // 模拟3秒识别时间
        setTimeout(() => {
            // 模拟识别成功
            statusTip.innerHTML = '<i class="fas fa-check-circle"></i> 人脸识别成功';
            statusTip.className = 'status-tip success';
            submitBtn.disabled = false;

            // 实际项目中这里调用真实API:
            // console.log('照片数据:', photoData);
            // 将photoData发送到后端进行人脸识别
        }, 3000);
    }

    // 重新拍摄
    function retryPhoto() {
        resultContainer.style.display = 'none';
        isCaptured = false;
        photoData = null;
        statusTip.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在识别中...';
        statusTip.className = 'status-tip';
        submitBtn.disabled = true;
        initCamera();
    }

    // 提交识别结果
    function submitRecognition() {
        // 这里添加实际提交逻辑
        alert('人脸识别信息已提交（预留接口）');
        localStorage.setItem('is_face_rec', 'true')
        // 跳转到结果页面
        window.location.href = 'mine.html';
    }

    // 事件监听
    captureBtn.addEventListener('click', capturePhoto);
    retryBtn.addEventListener('click', retryPhoto);
    submitBtn.addEventListener('click', submitRecognition);

    // 初始化页面
    initCamera();
</script>
</body>
</html>